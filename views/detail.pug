doctype html
html(lang="en")
    head
        include common_headers.pug
        - var tt = doc[1] ? doc[1]+' - '+doc[4]+' | Bing Daily HD wallpapers' : doc[4];
        title #{tt}
        - var location = (doc[7] && doc[6]) ? doc[7] + ', ' + doc[6] : false;
        - location = doc[8] ? (location ? doc[8] + ', ' + location : doc[8]) : location;
        meta(name="keywords", content=`${doc[4]}, ${doc[1]}, ${location}, ${doc.dt}`)
        meta(name="description", content=`${doc[3]}`)
        meta(name="author", content=`${doc[4]}`)
        link(rel='stylesheet', href="/static/css/progressively.css")
        link(rel='stylesheet', href='/static/css/common.css')
        link(rel='stylesheet', href='/static/css/main.css')

    body.detail
        div.preview
            div.progressive
                img.target.progressive__img.progressive--not-loaded(src=doc.small, data-progressive=doc.large)
            div.mark
            div.options
                a.ctrl.left(href=`${doc.back_url}`)
                    i.icon.icon-left
                    em.t BACK
                span.ctrl.heart(photo=doc[0], likes=doc[10])
                    i.icon.icon-heart
                    em.t #{doc[10]}
                a.ctrl.download(href=`/photo/${doc[5]}?force=download`,target="_blank")
                    i.icon.icon-download
                    em.t #{doc[12]}
            div.description
                p.title #{doc[4]}
                p.sub #{doc[3]}
                p.calendari.icon.icon-calendar
                    em.t #{doc[9]}
                if location
                    p.location
                        i.icon.icon-location
                        em.t #{location}
                p.view
                    i.icon.icon-eye
                    em.t #{doc[11]}
        script(src='/static/js/jquery-1.12.4.min.js')
        script(src='/static/js/progressively.js')
        script(src='/static/js/like.js')
        script.
            $(function () {
                var i = 0;
                var img = $('.target');
                var mini = img.attr('src');
                var mark = $('.mark');
                mark.css({
                    'background-image': 'url(' + mini + ')'
                });
                progressively.init({
                    delay: 20,
                    throttle: 300,
                    onLoad: function (elem) {
                    },
                    onLoadComplete: function () {
                        i++;
                        if (i >= 2) {
                            var big = img.attr('src');
                            mark.css({
                                backgroundImage: 'url(' + big + ')',
                                filter: 'blur(0)'
                            });
                            img.remove();
                        }
                    }
                });

                $(document).on('keydown', function (e) {
                    e = e.event || window.event;
                    if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && e.keyCode === 73) || (e.ctrlKey && e.keyCode === 85)) return false
                })
            });
